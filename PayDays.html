<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MicroSiteKit ‚Äì Pay Day Countdown Playground</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="Assets/css/style.css" rel="stylesheet" />
</head>

<body class="glass">
    <div id="shared-header"></div>
    <div id="main-nav"></div>
    <div id="sidebar-nav"></div>

    <div class="container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb" id="breadcrumb"></ol>
        </nav>
        <div class="row">
            <div class="col-md-4 gradient-col d-flex align-items-center justify-content-center text-start">
                <h3 class="gradient-text">Countdowns</h3>
            </div>
            <div class="col-md-8">
                <h4>üí∑ Pay Day Countdown Playground</h4>
                <p>Generate multiple pay day countdowns with visibility windows and live timers. Perfect for ESR
                    dashboards and contributor-facing microsites.</p>
                <ul>
                    <li>üìÜ Editable table for pay dates</li>
                    <li>‚è≥ Live countdown with pulse animation</li>
                    <li>üìÇ Save, load, and copy your config</li>
                </ul>
            </div>
        </div>

        <div class="row mt-4">
            <div class="col-md border border-primary rounded p-3">
                <section class="playground mt-5">
                    <h3>üîß Playground</h3>
                    <div class="mb-3">
                        <label for="imageUrl" class="form-label">üñºÔ∏è Banner Image URL (optional)</label>
                        <input type="text" id="imageUrl" class="form-control"
                            placeholder="https://example.com/banner.png" />
                    </div>
                    <table class="table table-bordered" id="paydayTable">
                        <thead class="table-light">
                            <tr>
                                <th>Pay Date</th>
                                <th>Label</th>
                                <th>Visible From</th>
                                <th>Visible To</th>
                                <th>üóëÔ∏è</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><input type="date" class="form-control" value="2025-11-28" /></td>
                                <td><input type="text" class="form-control" value="28th November" /></td>
                                <td><input type="date" class="form-control" value="2025-11-10" /></td>
                                <td><input type="date" class="form-control" value="2025-11-28" /></td>
                                <td><button class="btn btn-danger" onclick="removeRow(this)">‚úñ</button></td>
                            </tr>
                        </tbody>
                    </table>
                    <button class="btn btn-secondary mb-3" onclick="addRow()">‚ûï Add Row</button>

                    <div class="dohicky-grid">
                        <div class="dohicky-item"><button type="button" id="generateBtn"
                                class="btn btn-primary w-100">Generate Code</button></div>
                        <div class="dohicky-item"><button type="button" class="btn btn-primary w-100"
                                onclick="copyCode()">Copy</button></div>
                        <div class="dohicky-item"><button type="button" class="btn btn-primary w-100"
                                onclick="exportConfig()">üíæ Save Settings</button></div>
                        <div class="dohicky-item">
                            <input type="file" id="configFile" accept=".txt" style="display:none" />
                            <button type="button" class="btn btn-primary w-100"
                                onclick="document.getElementById('configFile').click()">üìÇ Load Settings</button>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-md-6 border border-primary rounded p-3">
                            <h5>Generated Code</h5>
                            <pre><code id="output"></code></pre>
                        </div>
                        <div class="col-md-6 border border-primary rounded p-3">
                            <h5>Live Preview</h5>
                            <div id="previewArea"></div>
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <div class="row mt-5">
            <div class="col-md">
                <h5 class="mt-4 mb-2">üß© Snippet Guide: Multi-Date Countdown</h5>
                <ul>
                    <li><strong>Edit your table</strong> to match your pay dates and visibility windows.</li>
                    <li>
                        <strongEach countdown</strong> appears only during its configured window.
                    </li>
                    <li><strong>Pulse animation</strong> draws attention to the ticking timer.</li>
                    <li><strong>Closed message</strong> appears automatically after the deadline.</li>
                </ul>
            </div>
        </div>

        <div id="shared-footer"></div>

        <!-- Bootstrap JS + Playground Scripts -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js"></script>
        <script src="Assets/js/script.js"></script>
        <script src="Assets/js/templates.js"></script>
        <script src="Assets/js/countdown-playground.js"></script>

        <script>
            // Add a new row to the table
            function addRow(data = {}) {
                const table = document.querySelector("#paydayTable tbody");
                const row = table.insertRow();
                const fields = [
                    { type: "date", value: data.PDpayDate || "" },
                    { type: "text", value: data.PDpayDateLabel || "" },
                    { type: "date", value: data.PDvisibleFrom || "" },
                    { type: "date", value: data.PDvisibleTo || "" }
                ];

                fields.forEach(field => {
                    const cell = row.insertCell();
                    const input = document.createElement("input");
                    input.type = field.type;
                    input.value = field.value;
                    input.className = "form-control";
                    cell.appendChild(input);
                });

                const deleteCell = row.insertCell();
                deleteCell.innerHTML = `<button class="btn btn-danger" onclick="removeRow(this)">‚úñ</button>`;
            }

            // Remove a row
            function removeRow(button) {
                button.closest("tr").remove();
            }

            // Build config object from table
            function getPaydayConfigFromTable() {
                const rows = document.querySelectorAll("#paydayTable tbody tr");
                const countdowns = Array.from(rows).map(row => {
                    const inputs = row.querySelectorAll("input");
                    return {
                        PDpayDate: inputs[0].value,
                        PDpayDateLabel: inputs[1].value,
                        PDvisibleFrom: inputs[2].value,
                        PDvisibleTo: inputs[3].value
                    };
                });

                const imageUrl = document.getElementById("imageUrl").value.trim();
                return {
                    imageUrl,
                    countdowns
                };
            }

            // Generate HTML from config
            function generateCountdowns() {
                const config = getPaydayConfigFromTable();
                const html = templates.payday(config);
                document.getElementById("output").textContent = html;
                document.getElementById("previewArea").innerHTML = html;
            }

            // Copy generated code
            function copyCode() {
                const rawText = document.getElementById("output").textContent;
                const cleanText = rawText
                    .replace(/[\u2018\u2019\u201A\u201B\u2032\u2035]/g, "'")
                    .replace(/[\u201C\u201D\u201E\u201F\u2033\u2036]/g, '"')
                    .replace(/[\u2013]/g, '-')
                    .replace(/[\u2014]/g, '--')
                    .replace(/\u00A0/g, ' ')
                    .replace(/\u2026/g, '...')
                    .replace(/\u200B/g, '')
                    .replace(/\uFEFF/g, '');
                navigator.clipboard.writeText(cleanText);
                alert("Code copied (smart characters cleaned)!");
            }

            // Export config as .txt
            function exportConfig() {
                const config = getPaydayConfigFromTable();
                const blob = new Blob([JSON.stringify(config, null, 2)], { type: "text/plain" });
                const link = document.createElement("a");
                link.href = URL.createObjectURL(blob);
                link.download = "payday-config.txt";
                link.click();
            }

            // Load config from file
            document.getElementById("configFile").addEventListener("change", function () {
                const file = this.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function (e) {
                    try {
                        const config = JSON.parse(e.target.result);

                        // üñºÔ∏è Update image field
                        document.getElementById("imageUrl").value = config.imageUrl || "";

                        // üóìÔ∏è Rebuild table
                        const tableBody = document.querySelector("#paydayTable tbody");
                        tableBody.innerHTML = "";
                        config.countdowns.forEach(entry => addRow(entry));

                        // üîÑ Refresh preview
                        generateCountdowns();
                    } catch (err) {
                        alert("Invalid config file.");
                    }
                };
                reader.readAsText(file);
            });

            // Initial row
            document.addEventListener("DOMContentLoaded", () => {
                if (document.querySelector("#paydayTable tbody").rows.length === 0) {
                    addRow({
                        PDpayDate: "2025-11-28",
                        PDpayDateLabel: "28th November",
                        PDvisibleFrom: "2025-11-10",
                        PDvisibleTo: "2025-11-28"
                    });
                }

                document.getElementById("generateBtn").addEventListener("click", generateCountdowns);
            });
        </script>