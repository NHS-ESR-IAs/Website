<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MicroSiteKit ‚Äì Countdown Playground</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="Assets/css/style.css" rel="stylesheet" />
</head>

<body class="glass">
    <!-- Injected Partials -->
    <div id="shared-header"></div>
    <div id="main-nav"></div>
    <div id="sidebar-nav"></div>

    <!-- Page Content -->
    <div class="container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb" id="breadcrumb"></ol>
        </nav>
        <div class="row">
            <!-- Sidebar Gradient Title -->
            <div class="col-md-4 gradient-col d-flex align-items-center justify-content-center text-start">
                <h3 class="gradient-text">Countdowns</h3>
            </div>

            <!-- Intro Text -->
            <div class="col-md-8">
                <h4>üéÑ Countdown Playground</h4>
                <p>Countdowns are joyful timers that build anticipation for the big day‚Äîwhether it‚Äôs pay day, launch
                    day, or mince pie day. They‚Äôre animated, accessible, and fully remixable.</p>
                <ul>
                    <li>‚è≥ Live countdown to any date</li>
                    <li>‚ùÑÔ∏è Optional snowflake animation</li>
                    <li>üé® Custom message, emojis, and styles</li>
                </ul>
                <p>Use them to spark excitement, mark milestones, or sprinkle a little seasonal magic into your
                    microsite.</p>
            </div>
        </div>

        <!-- Playground Panel -->
        <div class="row mt-4">
            <div class="col-md border border-primary rounded p-3">
                <section class="playground mt-5">
                    <h3>üîß Playground</h3>

                    <form id="playgroundForm" class="mb-3 row g-3">
                        <!-- Fields will be injected here by renderPlayground -->

                    </form>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="toggleDays" checked>
                        <label class="form-check-label" for="toggleDays">Show Days</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="toggleHours" checked>
                        <label class="form-check-label" for="toggleHours">Show Hours</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="toggleMinutes" checked>
                        <label class="form-check-label" for="toggleMinutes">Show Minutes</label>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="toggleSeconds" checked>
                        <label class="form-check-label" for="toggleSeconds">Show Seconds</label>
                    </div>
                    <div class="dohicky-grid">
                        <div class="dohicky-item"><button type="button" id="generateBtn"
                                class="btn btn-primary w-100">Generate Code</button></div>
                        <div class="dohicky-item"><button type="button" class="btn btn-primary w-100"
                                onclick="copyCode()">Copy</button></div>
                        <div class="dohicky-item"><button type="button" class="btn btn-primary w-100"
                                onclick="exportConfig()">üíæ Save Settings</button></div>
                        <div class="dohicky-item">
                            <input type="file" id="configFile" accept=".txt" style="display:none" />
                            <button type="button" class="btn btn-primary w-100"
                                onclick="document.getElementById('configFile').click()">üìÇ Load Settings</button>
                        </div>
                    </div>

                    <div class="row mt-4">
                        <div class="col-md-6 border border-primary rounded p-3">
                            <h5>Generated Code</h5>
                            <pre><code id="output"></code></pre>
                        </div>
                        <div class="col-md-6 border border-primary rounded p-3">
                            <h5>Live Preview</h5>
                            <div id="previewArea"></div>
                        </div>
                    </div>
                </section>
            </div>
        </div>

        <!-- Snippet Guide -->
        <div class="row mt-5">
            <div class="col-md">
                <h5 class="mt-4 mb-2">üß© Snippet Guide: Countdown with Cheer</h5>
                <ul>
                    <li><strong>Set your date</strong> to any future milestone‚Äîpay day, launch day, or even biscuit
                        o‚Äôclock.</li>
                    <li><strong>Customize the message</strong> that appears when the countdown hits zero.</li>
                    <li><strong>Sprinkle emojis</strong> for festive flair or team in-jokes.</li>
                    <li><strong>Adjust snowflakes</strong> for a gentle flurry or full-on blizzard.</li>
                    <li><strong>Copy or save</strong> your config to reuse across pages or share with your team.</li>
                </ul>
            </div>
        </div>

        <!-- Footer -->
        <div id="shared-footer"></div>

        <!-- Bootstrap JS + Playground Scripts -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js"></script>
        <script src="Assets/js/script.js"></script>
        <script src="Assets/js/templates.js"></script>


        <script>
            document.addEventListener("DOMContentLoaded", () => {
                // Make config global
                window.config = {
                    fields: [
                        { id: "countdownId", label: "Countdown ID", type: "text", default: "christmasCountdown" },
                        { id: "title", label: "Countdown Title", type: "text", default: "üéÖ Countdown to Christmas Pay Day üéÅ" },
                        { id: "payday", label: "Pay Day Date", type: "date", default: "2025-12-22" },
                        { id: "message", label: "Pay Day Message", type: "text", default: "üí∑ It's Pay Day! Merry Christmas!" },
                        { id: "emojiRow", label: "Emoji Row", type: "text", default: "üí∑ üéÑ ‚ùÑÔ∏è ‚õÑ üîî üåü üç™ üïØÔ∏è" },
                        { id: "snowflakes", label: "Number of Snowflakes", type: "range", min: 5, max: 40, step: 1, default: 20 }
                    ],
                    template: "countdown"
                };

                renderPlayground(window.config);

                const generateBtn = document.getElementById("generateBtn");
                if (generateBtn) {
                    generateBtn.onclick = () => {
                        const values = {};

                        // Collect values from configured fields
                        window.config.fields.forEach((f) => {
                            const el = document.getElementById(f.id);
                            if (el) values[f.id] = el.value;
                        });

                        // Collect manual checkboxes
                        values.toggleDays = document.getElementById("toggleDays").checked;
                        values.toggleHours = document.getElementById("toggleHours").checked;
                        values.toggleMinutes = document.getElementById("toggleMinutes").checked;
                        values.toggleSeconds = document.getElementById("toggleSeconds").checked;

                        let code = "";
                        try {
                            if (templates && templates[window.config.template]) {
                                code = templates[window.config.template](values) || "";
                            }
                        } catch (err) {
                            console.error("Template generation failed:", err);
                        }

                        // Update output box
                        const outputEl = document.getElementById("output");
                        if (outputEl) outputEl.textContent = code.trim();

                        // Update preview
                        const previewEl = document.getElementById("previewArea");
                        if (previewEl && code) {
                            previewEl.innerHTML = code;
                        }
                    };
                }
            });

            // ---------------- Helpers ----------------
            function sanitizeSmartCharacters(str) {
                return str
                    .replace(/[\u2018\u2019\u201A\u201B\u2032\u2035]/g, "'")
                    .replace(/[\u201C\u201D\u201E\u201F\u2033\u2036]/g, '"')
                    .replace(/[\u2013]/g, '-')
                    .replace(/[\u2014]/g, '--')
                    .replace(/\u00A0/g, ' ')
                    .replace(/\u2026/g, '...')
                    .replace(/\u200B/g, '')
                    .replace(/\uFEFF/g, '');
            }

            function copyCode() {
                const rawText = document.getElementById("output").textContent;
                const cleanText = sanitizeSmartCharacters(rawText);
                navigator.clipboard.writeText(cleanText);
                alert("Code copied (smart characters cleaned)!");
            }
        </script>
    </div>
</body>

</html>