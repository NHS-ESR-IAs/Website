<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MicroSiteKit ‚Äì Gantt Chart Page</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet" />

    <!-- Custom Styles -->
    <link href="Assets/css/style.css" rel="stylesheet" />

    <!-- Mermaid Setup -->
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <script type="module">
        import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";
        mermaid.initialize({ startOnLoad: false });
        window.mermaid = mermaid;
    </script>
</head>

<body class="glass">
    <!-- Injected Partials -->
    <div id="shared-header"></div>
    <div id="main-nav"></div>
    <div id="sidebar-nav"></div>

    <!-- Page-Specific Content -->
    <div class="container">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb" id="breadcrumb"></ol>
        </nav>
        <div class="row">
            <div class="col-md-4 gradient-col d-flex align-items-center justify-content-center">
                <h3 class="gradient-text">Gantt Chart Page</h3>
            </div>
            <div class="col-md-8">
                <div class="page-intro text-center py-4 px-3">
                    <p>This example shows how to use Mermaid syntax to create a Gantt chart directly in your microsite.
                        It‚Äôs ideal for visualising project timelines, milestones, and dependencies.</p>

                    <ul>
                        <li>üìÖ Clear timeline view of tasks and phases</li>
                        <li>üé® Theme-safe and layout-friendly‚Äîuses Bootstrap spacing</li>
                        <li>üß© Modular and editable‚Äîgreat for planning and tracking</li>
                        <li>üìã Includes copy-to-clipboard button for easy reuse</li>
                    </ul>
                </div>
            </div>

            <!-- Page full width content -->
            <div class="row mt-4">
                <div class="col-md">
                    <h5 class="mt-4 mb-2">üìä Gantt Chart Example</h5>
                    <p>This Mermaid block renders a Gantt chart showing a simple project timeline. You can customise
                        tasks, dates, and dependencies to suit your own workflow.</p>

                    <!-- Mermaid Diagram Block -->
                    <pre class="mermaid snippet">
gantt
  title Microsite Launch Plan
  dateFormat  YYYY-MM-DD
  axisFormat  %d-%b

  section Planning
  Define requirements     :done,    des1, 2025-10-01,2025-10-05
  Design wireframes       :active,  des2, 2025-10-06, 5d

  section Development
  Build frontend          :des3,    2025-10-12, 7d
  Integrate backend       :des4,    after des3, 5d

  section Testing
  Unit testing            :des5,    after des4, 3d
  User acceptance testing :des6,    after des5, 4d

  section Launch
  Final review            :des7,    2025-10-28, 2d
  Go live                 :milestone, des8, 2025-10-31, 0d
                    </pre>

                    <!-- Customisation Tips -->
                    <div class="mt-4">
                        <h6>üõ†Ô∏è How to Customise</h6>
                        <ul>
                            <li><strong>Change dates:</strong> Update <code>YYYY-MM-DD</code> values</li>
                            <li><strong>Adjust durations:</strong> Use <code>Xd</code> for days (e.g., <code>5d</code>)
                            </li>
                            <li><strong>Dependencies:</strong> Use <code>after taskID</code> to chain tasks</li>
                            <li><strong>Status:</strong> Add <code>:done</code>, <code>:active</code>, or
                                <code>:milestone</code>
                            </li>
                        </ul>
                        <pre><code class="snippet language-html">
&lt;div class=&quot;mermaid snippet&quot;&gt;
gantt
  title Microsite Launch Plan
  dateFormat  YYYY-MM-DD
  axisFormat  %d-%b

  section Planning
  Define requirements     :done,    des1, 2025-10-01,2025-10-05
  Design wireframes       :active,  des2, 2025-10-06, 5d

  section Development
  Build frontend          :des3,    2025-10-12, 7d
  Integrate backend       :des4,    after des3, 5d

  section Testing
  Unit testing            :des5,    after des4, 3d
  User acceptance testing :des6,    after des5, 4d

  section Launch
  Final review            :des7,    2025-10-28, 2d
  Go live                 :milestone, des8, 2025-10-31, 0d
&lt;/div&gt;
</code></pre>
                        <!-- Copy Button -->
                        <button class="btn btn-primary w-100 mb-2" onclick="copyVisibleSnippet()">Copy</button>
                    </div>
                </div>
                <div class="row mt-4">
                    <div class="col-md border border-primary rounded p-3">
                        <section class="playground mt-5">
                            <h3>üìÖ Gantt Chart Playground</h3>

                            <div class="mb-3">
                                <label class="form-label">Chart Title</label>
                                <input type="text" id="ganttTitle" class="form-control" value="Microsite Launch Plan">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Date Format</label>
                                <input type="text" id="ganttDateFormat" class="form-control" value="YYYY-MM-DD">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Axis Format</label>
                                <input type="text" id="ganttAxisFormat" class="form-control" value="%d-%b">
                            </div>

                            <h5>Sections</h5>
                            <div id="sectionsForm"></div>
                            <button type="button" id="addSectionBtn" class="btn btn-success mb-3">+ Add Section</button>
                            <br>
                            <div class="dohicky-grid">
                                <div class="dohicky-item"><button type="button" id="generateBtn"
                                        class="btn btn-primary w-100">Generate Code</button></div>
                                <div class="dohicky-item"><button type="button" class="btn btn-primary w-100"
                                        onclick="copyCode()">Copy</button></div>
                                <div class="dohicky-item"><button type="button" class="btn btn-primary w-100"
                                        onclick="exportConfig()">üíæ Save Settings</button></div>
                                <div class="dohicky-item"> <input type="file" id="configFile" accept=".txt"
                                        style="display:none" /> <button type="button" class="btn btn-primary w-100"
                                        onclick="document.getElementById('configFile').click()">üìÇ Load
                                        Settings</button>
                                </div>
                            </div>

                            <div class="row mt-4">
                                <div class="col-md-6 border border-primary rounded p-3">
                                    <h5>Generated Code</h5>
                                    <pre><code id="output"></code></pre>
                                </div>
                                <div class="col-md-6 border border-primary rounded p-3">
                                    <h5>Live Preview</h5>
                                    <div id="previewArea"></div>
                                </div>
                            </div>
                        </section>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div id="shared-footer"></div>

        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/fuse.js/dist/fuse.min.js"></script>
        <!-- Custom JS -->
        <script src="Assets/js/script.js"></script>
        <script src="Assets/js/templates.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const sectionsForm = document.getElementById("sectionsForm");

                function createSection(defaults = { name: "", tasks: [] }) {
                    const wrapper = document.createElement("div");
                    wrapper.className = "section border rounded p-2 mb-3";

                    wrapper.innerHTML = `
  <label class="form-label">Section Name</label>
  <input type="text" class="form-control mb-2" name="sectionName" value="${defaults.name}">

  <div class="row fw-bold mb-1">
    <div class="col-md-3">Label</div>
    <div class="col-md-2">Status</div>
    <div class="col-md-2">ID</div>
    <div class="col-md-2">Start Date</div>
    <div class="col-md-2">Duration</div>
    <div class="col-md-1">Action</div>
  </div>

  <div class="tasks"></div>
  <button type="button" class="btn btn-success btn-sm addTaskBtn mb-2">+ Add Task</button>
  <button type="button" class="btn btn-danger btn-sm removeSectionBtn">Remove Section</button>
`;

                    const tasksContainer = wrapper.querySelector(".tasks");
                    defaults.tasks.forEach(t => addTask(tasksContainer, t));

                    wrapper.querySelector(".addTaskBtn").onclick = () => addTask(tasksContainer);
                    wrapper.querySelector(".removeSectionBtn").onclick = () => wrapper.remove();

                    sectionsForm.appendChild(wrapper);
                }

                function addTask(container, defaults = { label: "", status: "", id: "", start: "", duration: "" }) {
                    const row = document.createElement("div");
                    row.className = "task-row row g-2 mb-2 align-items-end";

                    row.innerHTML = `
    <div class="col-md-3">
      <input type="text" class="form-control" name="label" placeholder="Task label" value="${defaults.label}">
    </div>
    <div class="col-md-2">
      <select class="form-select" name="status">
        <option value="" ${defaults.status === "" ? "selected" : ""}>‚Äî</option>
        <option value="done" ${defaults.status === "done" ? "selected" : ""}>Done</option>
        <option value="active" ${defaults.status === "active" ? "selected" : ""}>Active</option>
        <option value="milestone" ${defaults.status === "milestone" ? "selected" : ""}>Milestone</option>
      </select>
    </div>
    <div class="col-md-2">
      <input type="text" class="form-control" name="id" placeholder="ID" value="${defaults.id}">
    </div>
    <div class="col-md-2">
      <input type="date" class="form-control" name="start" value="${defaults.start}">
    </div>
    <div class="col-md-2">
      <input type="text" class="form-control" name="duration" placeholder="e.g. 5d or 2025-10-05" value="${defaults.duration}">
    </div>
    <div class="col-md-1">
      <button type="button" class="btn btn-danger btn-sm removeTaskBtn">Remove</button>
    </div>
  `;

                    row.querySelector(".removeTaskBtn").onclick = () => row.remove();
                    container.appendChild(row);
                }

                // Seed with your example
                createSection({
                    name: "Planning",
                    tasks: [
                        { label: "Define requirements", status: "done", id: "des1", start: "2025-10-01", duration: "2025-10-05" },
                        { label: "Design wireframes", status: "active", id: "des2", start: "2025-10-06", duration: "5d" }
                    ]
                });
                createSection({
                    name: "Development",
                    tasks: [
                        { label: "Build frontend", id: "des3", start: "2025-10-12", duration: "7d" },
                        { label: "Integrate backend", id: "des4", start: "after des3", duration: "5d" }
                    ]
                });
                createSection({
                    name: "Testing",
                    tasks: [
                        { label: "Unit testing", id: "des5", start: "after des4", duration: "3d" },
                        { label: "User acceptance testing", id: "des6", start: "after des5", duration: "4d" }
                    ]
                });
                createSection({
                    name: "Launch",
                    tasks: [
                        { label: "Final review", id: "des7", start: "2025-10-28", duration: "2d" },
                        { label: "Go live", status: "milestone", id: "des8", start: "2025-10-31", duration: "0d" }
                    ]
                });

                document.getElementById("generateBtn").onclick = () => {
                    const title = document.getElementById("ganttTitle").value;
                    const dateFormat = document.getElementById("ganttDateFormat").value;
                    const axisFormat = document.getElementById("ganttAxisFormat").value;

                    const fallbackDate = "2025-10-01"; // or new Date().toISOString().slice(0,10)

                    const sections = [...sectionsForm.querySelectorAll(".section")].map(sec => {
                        const name = sec.querySelector('[name="sectionName"]').value;
                        const tasks = [...sec.querySelectorAll(".task-row")].map(r => {
                            let start = r.querySelector('[name="start"]').value.trim();
                            if (!start) start = fallbackDate; // auto‚Äëfill if blank
                            return {
                                label: r.querySelector('[name="label"]').value,
                                status: r.querySelector('[name="status"]').value,
                                id: r.querySelector('[name="id"]').value,
                                start,
                                duration: r.querySelector('[name="duration"]').value
                            };
                        });
                        return { name, tasks };
                    });

                    const code = templates.gantt({ title, dateFormat, axisFormat, sections });
                    document.getElementById("output").textContent = code.trim();
                    document.getElementById("previewArea").innerHTML = code;
                    if (window.mermaid) mermaid.init(undefined, document.querySelectorAll(".mermaid"));
                };
            });

            function sanitizeSmartCharacters(str) {
                return str
                    .replace(/[\u2018\u2019\u201A\u201B\u2032\u2035]/g, "'") // single quotes
                    .replace(/[\u201C\u201D\u201E\u201F\u2033\u2036]/g, '"') // double quotes
                    .replace(/[\u2013]/g, '-') // en dash
                    .replace(/[\u2014]/g, '--') // em dash
                    .replace(/\u00A0/g, ' ') // non-breaking space
                    .replace(/\u2026/g, '...') // ellipsis
                    .replace(/\u200B/g, '') // zero-width space
                    .replace(/\uFEFF/g, ''); // BOM
            }

            function copyCode() {
                const rawText = document.getElementById("output").textContent;
                const cleanText = sanitizeSmartCharacters(rawText);
                navigator.clipboard.writeText(cleanText);
                alert("Code copied (smart characters cleaned)!");
            }
        </script>
</body>

</html>